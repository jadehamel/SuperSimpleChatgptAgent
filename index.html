<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>A.I. Agent Interface</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background-color: #f0f0f0;
      min-height: 100vh;
      flex-direction: column;
      overflow-y: scroll;
    }

    #chat-container {
      width: 80%;
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      margin-top: 40px;
    }
    #chat-box {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
    }
    #chat-get-api-link {
      display: inline-block;
      flex-direction: column;
      overflow: hidden;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .message {
      margin-bottom: 15px;
    }
    .message.user {
      text-align: right;
    }
    .message p {
      display: inline-block;
      padding: 10px 15px;
      border-radius: 20px;
      max-width: 80%;
    }
    .message.user p {
      background-color: #0084ff;
      color: white;
    }
    .message.bot p {
      background-color: #e5e5ea;
      color: black;
    }
    .input-container {
      display: flex;
      border-top: 1px solid #ddd;
      padding: 10px;
    }
    .input-container input {
      flex: 1;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 20px;
    }
    .input-container select {
      flex: 1;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 20px;
    }
    .input-text {
      font-family: Arial, sans-serif;
      flex: 1;
      width: 25%;
      padding: 10px;
      display: block;
      margin-bottom: 20px;
    }
    .input-container text {
      font-family: Arial, sans-serif;
      font-weight: lighter;
    }
    .input-container textarea {
      display: block;
      font-family: Arial, sans-serif;
      flex: 1;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 20px;
    }
    .input-container button {
      padding: 10px 15px;
      border: none;
      background-color: #0084ff;
      color: white;
      border-radius: 20px;
      margin-left: 10px;
      cursor: pointer;
    }
    #agent-bot-setting {
      text-align: left;
    }
    #agent-end-point-setting {
      text-align: center;
    }
    #agent-model-setting {
      text-align: right;
    }
    #agentRole {
      height: 100px;
      resize: vertical;
    }
    #link-container {
      display: flex;
      border-top: 1px solid #ddd;
      padding: 10px;
      justify-content: center;
      align-items: center;
    }
    #link-container link {
      flex: 1;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 20px;
      outline: none;
    }
  </style>
</head>
<body>
  <div id="chat-container">
    <div class="input-container">
      My Custom A.I. Agent
    </div>
    <div class="input-container">
      <table width="100%">
        <tr>
          <td id="agent-bot-setting">
            <table>
              <tr>
                <td>Bot: </td>
                <td>
                  <select id="agentBot" name="agentBot">
                  <option value="chatGPT" selected>ChatGPT</option>
                  <option value="Llama">Llama</option>
                  </select>
                </td>
              </tr>
            </table>
          </td>
          <td id="agent-end-point-setting">
            <table>
              <tr>
                <td>EndPoint: </td>
                <td>
                  <input type="text" id="agentEndPoint" name="agentEndPoint" value="  https://api.openai.com/v1/chat/completions">
                </td>
              </tr>
            </table>
          </td>  
          <td id="agent-model-setting">
            <table>
              <tr>
                <td>Model: </td>
                <td>
                  <input type="text" id="agentModel" name="agentModel" value="gpt-3.5-turbo">
                </td>
              </tr>
            </table>
          </td>
        </tr>
      </table>
    </div>
    <div id="chat-box"></div>
    <div class="input-container">
      <input type="text" id="user-input" placeholder="Type a message...">
      <button id="send-button">Send</button>
    </div>
    <div class="input-container">
      Agent Role
    </div>
    <div class="input-container">
      <textarea wrap="hard" id="agentRole" name="agentRole" placeholder="Provide your agent role...">You are a friendly and helpful assistant named Alex. You are knowledgeable in technology, science, and literature. Always be polite and use simple, easy-to-understand language.</textarea>
    </div>
    <div class="input-container">
      <input type="text" id="apikeyInput" name="apikey" placeholder="YOU API KEY...">
    </div>
    <div id="link-container">
      <a href="https://platform.openai.com/api-keys" target="_blank">Get your OpenAI API KEY</a>
    </div>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      var apiKeyInput = document.getElementById('apikeyInput');
      var agentRole = document.getElementById('agentRole');
      var agentBot = document.getElementById('agentBot');
      var chatBox = document.getElementById('chat-box');
      var endPoint = "https://api.openai.com/v1/chat/completions";
      var AgentModel = "gpt-3.5-turbo";
      var AgentEndPoint = "https://api.openai.com/v1/chat/completions";
      var botModel = document.getElementById('agentModel');
      var botEndPoint = document.getElementById('agentEndPoint');
      botModel.value = AgentModel;
      botEndPoint.value = endPoint;

      function getCookieValue(cookieName) {
        var name = cookieName + '=';
        var decodedCookie = decodeURIComponent(document.cookie);
        var cookieArray = decodedCookie.split(';');
        for (var i = 0; i < cookieArray.length; i++) {
          var cookie = cookieArray[i].trim();
          if (cookie.indexOf(name) === 0) {
            return cookie.substring(name.length, cookie.length);
          }
        }
        return '';
      }

      var agentApiKeyValue = getCookieValue('agent_apikey');
      if (agentApiKeyValue !== '') {
        apiKeyInput.value = agentApiKeyValue;
      }

      apiKeyInput.addEventListener('input', function() {
        var apiKeyValue = apiKeyInput.value;
        document.cookie = 'agent_apikey=' + encodeURIComponent(apiKeyValue);
      });

      var agentRoleValue = getCookieValue('agent_role');
      if (agentRoleValue !== '') {
        agentRole.value = agentRoleValue;
      }

      agentRole.addEventListener('input', function() {
        var agentRoleValue = agentRole.value;
        document.cookie = 'agent_role=' + encodeURIComponent(agentRoleValue);
      });

      var agentBotValue = getCookieValue('agent_bot');
      if (agentBotValue !== '') {
        agentBot.value = agentBotValue;
      }

      // Event listener for Agent Bot select changes
      agentBot.addEventListener('change', function(event) {
        var agentBotValue = agentBot.value;
        AgentEndPoint = (agentBotValue === "Llama") ? "http://localhost:1234/v1/chat/completions" : "https://api.openai.com/v1/chat/completions";
        document.cookie = 'agent_bot=' + encodeURIComponent(agentBotValue);
        botModel.value = "gpt-3.5-turbo";
        botEndPoint.value = AgentEndPoint;
      });

      // Event listener for send button click
      document.getElementById('send-button').addEventListener('click', sendMessage);

      // Event listener for user input enter key press
      document.getElementById('user-input').addEventListener('keypress', function(event) {
        if (event.key === 'Enter') {
          sendMessage();
        }
      });

      async function sendMessage() {
        const inputField = document.getElementById('user-input');
        const userMessage = inputField.value.trim();

        if (userMessage === '') {
          return;
        }

        appendMessage('user', userMessage);
        inputField.value = '';

        const botMessage = await getBotResponse(userMessage);
        appendMessage('bot', botMessage);
      }

      function appendMessage(sender, message) {
        const messageElement = document.createElement('div');
        messageElement.classList.add('message', sender);
        const messageContent = document.createElement('p');
        messageContent.textContent = message;
        messageElement.appendChild(messageContent);
        chatBox.appendChild(messageElement);
        chatBox.scrollTop = chatBox.scrollHeight;
      }

      async function getBotResponse(userMessage) {
        const apiKey = apiKeyInput.value || 'YOUR_API_KEY';  // Replace with your OpenAI API key
        const endpoint = AgentEndPoint || 'https://api.openai.com/v1/chat/completions';
        const payload = {
          model: AgentModel,
          messages: [
            { role: "system", content: agentRole.value || "You are a friendly and helpful assistant named Alex. You are knowledgeable in technology, science, and literature. Always be polite and use simple, easy-to-understand language." },
            { role: "user", content: userMessage }
          ],
          max_tokens: 150,
          temperature: 0.5,
          top_p: 0.9,
          frequency_penalty: 0.5,
          presence_penalty: 0.5
        };

        try {
          const response = await fetch(endpoint, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${apiKey}`
            },
            body: JSON.stringify(payload)
          });

          const data = await response.json();
          if (data.choices && data.choices.length > 0) {
            return data.choices[0].message.content.trim();
          } else {
            if (data.error && data.error.message) {
              return '(' + data.error.code + ') ' + data.error.message;
            } else {
              return 'Sorry, I am having trouble responding at the moment. Please try again later.';
            }
          }
        } catch (error) {
          console.error('Error:', error);
          return 'Sorry, I am having trouble responding at the moment. Please try again later.';
        }
      }
    });
  </script>
</body>
</html>
